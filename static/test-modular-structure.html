<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modular Structure</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Shared Styles -->
    <link rel="stylesheet" href="/static/shared/css/base.css">
    <link rel="stylesheet" href="/static/shared/css/dashboard-components.css">
</head>
<body class="bg-gray-50">
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Test Modular Structure</h1>
        
        <!-- Test Buttons -->
        <div class="mb-8 space-x-4">
            <button id="testApiClient" class="btn btn-primary">Test API Client</button>
            <button id="testFormatters" class="btn btn-primary">Test Formatters</button>
            <button id="testUIUtils" class="btn btn-primary">Test UI Utils</button>
            <button id="testCharts" class="btn btn-primary">Test Charts</button>
            <button id="testAnalytics" class="btn btn-primary">Test Analytics</button>
        </div>

        <!-- Results -->
        <div id="testResults" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h2 class="text-xl font-semibold mb-4">Test Results</h2>
            <div id="resultsContent" class="space-y-2">
                <p class="text-gray-600">Klik tombol di atas untuk menguji modul-modul.</p>
            </div>
        </div>

        <!-- Sample Chart -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h2 class="text-xl font-semibold mb-4">Sample Chart</h2>
            <div class="h-64">
                <canvas id="testChart"></canvas>
            </div>
        </div>

        <!-- Sample Stats -->
        <div class="mt-8 grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="stats-card">
                <div class="stats-card-header">
                    <h3 class="stats-card-title">Test Revenue</h3>
                </div>
                <div id="testRevenue" class="stats-card-value">Rp 0</div>
                <div id="testRevenueChange" class="stats-card-change"></div>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-header">
                    <h3 class="stats-card-title">Test Orders</h3>
                </div>
                <div id="testOrders" class="stats-card-value">0</div>
                <div id="testOrdersChange" class="stats-card-change"></div>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-header">
                    <h3 class="stats-card-title">Test Rate</h3>
                </div>
                <div id="testRate" class="stats-card-value">0%</div>
                <div id="testRateChange" class="stats-card-change"></div>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-header">
                    <h3 class="stats-card-title">Test Value</h3>
                </div>
                <div id="testValue" class="stats-card-value">Rp 0</div>
                <div id="testValueChange" class="stats-card-change"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Shared Utilities -->
    <script src="/static/shared/js/api-client.js"></script>
    <script src="/static/shared/js/formatters.js"></script>
    <script src="/static/shared/js/ui-utils.js"></script>
    <script src="/static/shared/js/mock-data.js"></script>
    
    <!-- Chart Components -->
    <script src="/static/components/charts/chart-manager.js"></script>
    <script src="/static/components/charts/analytics-charts.js"></script>
    
    <!-- Test Script -->
    <script>
        function addResult(message, type = 'info') {
            const resultsContent = document.getElementById('resultsContent');
            const resultDiv = document.createElement('div');
            resultDiv.className = `p-2 rounded text-sm ${
                type === 'success' ? 'bg-green-100 text-green-800' :
                type === 'error' ? 'bg-red-100 text-red-800' :
                'bg-blue-100 text-blue-800'
            }`;
            resultDiv.textContent = message;
            resultsContent.appendChild(resultDiv);
        }

        // Test API Client
        document.getElementById('testApiClient').addEventListener('click', () => {
            try {
                if (typeof ApiClient !== 'undefined' && typeof apiClient !== 'undefined') {
                    addResult('✓ API Client loaded successfully', 'success');
                    addResult(`✓ API Client methods: ${Object.getOwnPropertyNames(ApiClient.prototype).join(', ')}`, 'info');
                } else {
                    addResult('✗ API Client not loaded', 'error');
                }
            } catch (error) {
                addResult(`✗ API Client error: ${error.message}`, 'error');
            }
        });

        // Test Formatters
        document.getElementById('testFormatters').addEventListener('click', () => {
            try {
                if (typeof Formatters !== 'undefined') {
                    const testAmount = 1250000;
                    const formatted = Formatters.formatCurrency(testAmount);
                    addResult(`✓ Formatters loaded successfully`, 'success');
                    addResult(`✓ Format currency test: ${testAmount} → ${formatted}`, 'info');
                    
                    const testNumber = 1234567;
                    const formattedNumber = Formatters.formatNumber(testNumber);
                    addResult(`✓ Format number test: ${testNumber} → ${formattedNumber}`, 'info');
                } else {
                    addResult('✗ Formatters not loaded', 'error');
                }
            } catch (error) {
                addResult(`✗ Formatters error: ${error.message}`, 'error');
            }
        });

        // Test UI Utils
        document.getElementById('testUIUtils').addEventListener('click', () => {
            try {
                if (typeof UIUtils !== 'undefined') {
                    addResult('✓ UI Utils loaded successfully', 'success');
                    UIUtils.showToast('Test toast notification!', 'success', 2000);
                    addResult('✓ Toast notification test executed', 'info');
                } else {
                    addResult('✗ UI Utils not loaded', 'error');
                }
            } catch (error) {
                addResult(`✗ UI Utils error: ${error.message}`, 'error');
            }
        });

        // Test Charts
        document.getElementById('testCharts').addEventListener('click', () => {
            try {
                if (typeof ChartManager !== 'undefined' && typeof chartManager !== 'undefined') {
                    addResult('✓ Chart Manager loaded successfully', 'success');
                    
                    // Create test chart
                    const testData = MockDataGenerator.generateRevenueData(7);
                    const config = {
                        type: 'line',
                        data: {
                            labels: testData.map(item => Formatters.formatChartDate(item.date)),
                            datasets: [{
                                label: 'Test Revenue',
                                data: testData.map(item => item.revenue),
                                borderColor: 'rgb(59, 130, 246)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    };
                    
                    chartManager.createChart('testChart', config);
                    addResult('✓ Test chart created successfully', 'success');
                } else {
                    addResult('✗ Chart Manager not loaded', 'error');
                }
            } catch (error) {
                addResult(`✗ Charts error: ${error.message}`, 'error');
            }
        });

        // Test Analytics
        document.getElementById('testAnalytics').addEventListener('click', () => {
            try {
                if (typeof MockDataGenerator !== 'undefined') {
                    addResult('✓ Mock Data Generator loaded successfully', 'success');
                    
                    // Generate and display mock stats
                    const mockStats = MockDataGenerator.generateOverviewStats();
                    
                    document.getElementById('testRevenue').textContent = Formatters.formatCurrency(mockStats.total_revenue);
                    UIUtils.updateChangeIndicator(document.getElementById('testRevenueChange'), mockStats.revenue_change);
                    
                    document.getElementById('testOrders').textContent = Formatters.formatNumber(mockStats.total_orders);
                    UIUtils.updateChangeIndicator(document.getElementById('testOrdersChange'), mockStats.orders_change);
                    
                    document.getElementById('testRate').textContent = `${mockStats.conversion_rate.toFixed(1)}%`;
                    UIUtils.updateChangeIndicator(document.getElementById('testRateChange'), mockStats.conversion_change);
                    
                    document.getElementById('testValue').textContent = Formatters.formatCurrency(mockStats.avg_order_value);
                    UIUtils.updateChangeIndicator(document.getElementById('testValueChange'), mockStats.aov_change);
                    
                    addResult('✓ Mock analytics data displayed successfully', 'success');
                } else {
                    addResult('✗ Mock Data Generator not loaded', 'error');
                }
            } catch (error) {
                addResult(`✗ Analytics error: ${error.message}`, 'error');
            }
        });

        // Auto-run basic tests on load
        document.addEventListener('DOMContentLoaded', () => {
            addResult('🚀 Modular structure test page loaded', 'info');
            addResult('Klik tombol di atas untuk menguji setiap modul', 'info');
        });
    </script>
</body>
</html>
